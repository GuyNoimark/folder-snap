<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FolderIO ‚Äî Folder Structure Visualizer</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  :root {
    --bg: #0f1117;
    --surface: #181c27;
    --surface2: #1e2330;
    --border: #2a3040;
    --border-light: #323a4e;
    --accent: #f59e2a;
    --accent-dim: rgba(245,158,42,0.12);
    --accent-glow: rgba(245,158,42,0.25);
    --text-primary: #e8ecf4;
    --text-secondary: #8892a4;
    --text-muted: #4a5568;
    --green: #34d399;
    --blue: #60a5fa;
    --font-mono: 'JetBrains Mono', monospace;
    --font-body: 'Sora', sans-serif;
    --radius: 12px;
    --radius-sm: 7px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* --- Noise texture overlay --- */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
  }

  /* --- Header --- */
  header {
    width: 100%;
    max-width: 900px;
    padding: 40px 24px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
    z-index: 1;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo-icon {
    width: 34px; height: 34px;
    background: var(--accent);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 17px;
    box-shadow: 0 0 18px var(--accent-glow);
  }

  .logo-text {
    font-family: var(--font-mono);
    font-weight: 600;
    font-size: 17px;
    letter-spacing: -0.02em;
    color: var(--text-primary);
  }

  .logo-text span { color: var(--accent); }

  .tagline {
    font-size: 12px;
    color: var(--text-muted);
    font-family: var(--font-mono);
  }

  /* --- Main layout --- */
  main {
    width: 100%;
    max-width: 900px;
    padding: 28px 24px 60px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    position: relative;
    z-index: 1;
  }

  /* --- Input panel --- */
  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .panel-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface2);
  }

  .panel-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--border-light);
  }

  .panel-dot.active { background: var(--accent); box-shadow: 0 0 6px var(--accent-glow); }

  .panel-title {
    font-size: 12px;
    font-family: var(--font-mono);
    color: var(--text-secondary);
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
  }

  /* --- Tabs --- */
  .tabs {
    display: flex;
    padding: 16px 20px 0;
    gap: 4px;
  }

  .tab {
    padding: 7px 16px;
    border-radius: var(--radius-sm) var(--radius-sm) 0 0;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    border: 1px solid transparent;
    border-bottom: none;
    transition: all 0.2s;
    color: var(--text-muted);
    background: transparent;
    font-family: var(--font-body);
  }

  .tab:hover { color: var(--text-secondary); }

  .tab.active {
    background: var(--surface2);
    border-color: var(--border);
    color: var(--accent);
  }

  .tab-content {
    display: none;
    padding: 0 20px 20px;
    background: var(--surface2);
    border-top: 1px solid var(--border);
    margin: 0 0 0;
  }

  .tab-content.active { display: block; }

  textarea {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-size: 13px;
    line-height: 1.6;
    padding: 14px 16px;
    resize: vertical;
    min-height: 120px;
    margin-top: 16px;
    transition: border-color 0.2s;
    outline: none;
  }

  textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-dim);
  }

  textarea::placeholder { color: var(--text-muted); }

  /* --- Controls row --- */
  .controls {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    padding: 16px 20px;
    border-top: 1px solid var(--border);
    background: var(--surface);
  }

  .depth-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-family: var(--font-mono);
    white-space: nowrap;
  }

  .depth-options {
    display: flex;
    gap: 4px;
  }

  .depth-btn {
    padding: 5px 12px;
    border-radius: var(--radius-sm);
    font-size: 12px;
    font-family: var(--font-mono);
    font-weight: 500;
    cursor: pointer;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-muted);
    transition: all 0.15s;
  }

  .depth-btn:hover { border-color: var(--border-light); color: var(--text-secondary); }

  .depth-btn.active {
    background: var(--accent-dim);
    border-color: var(--accent);
    color: var(--accent);
  }

  #custom-depth-input {
    width: 52px;
    padding: 5px 8px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-size: 12px;
    text-align: center;
    outline: none;
    display: none;
    transition: border-color 0.2s;
  }

  #custom-depth-input:focus { border-color: var(--accent); }

  .spacer { flex: 1; }

  .btn {
    padding: 8px 18px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.18s;
    font-family: var(--font-body);
    display: flex;
    align-items: center;
    gap: 7px;
  }

  .btn-primary {
    background: var(--accent);
    color: #0f1117;
    box-shadow: 0 0 16px var(--accent-glow);
  }

  .btn-primary:hover {
    background: #f9ad40;
    box-shadow: 0 0 22px var(--accent-glow);
    transform: translateY(-1px);
  }

  .btn-primary:active { transform: translateY(0); }

  .btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border);
  }

  .btn-ghost:hover {
    border-color: var(--border-light);
    color: var(--text-primary);
    background: var(--surface2);
  }

  /* --- Output panel --- */
  .output-panel {
    display: none;
    flex-direction: column;
    gap: 0;
  }

  .output-panel.visible { display: flex; }

  .output-actions {
    display: flex;
    gap: 8px;
    align-items: center;
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
  }

  .output-actions .info {
    font-size: 12px;
    font-family: var(--font-mono);
    color: var(--text-muted);
  }

  .output-actions .info span {
    color: var(--accent);
  }

  /* --- Tree renderer --- */
  #tree-output {
    padding: 28px 32px;
    background: #f8f9fb;
    min-height: 200px;
  }

  .tree-root-path {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 6px;
    padding: 10px 14px;
    background: white;
    border-radius: 10px;
    border: 1px solid #e5e8ef;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
  }

  .tree-root-path .root-icon {
    font-size: 18px;
  }

  .tree-root-path .root-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    font-weight: 600;
    color: #2d3748;
    word-break: break-all;
  }

  .tree-node {
    display: flex;
    align-items: center;
    gap: 9px;
    padding: 6px 12px;
    border-radius: 8px;
    margin: 2px 0;
    transition: background 0.12s;
    cursor: default;
  }

  .tree-node:hover { background: rgba(245,158,42,0.07); }

  .tree-node .folder-icon {
    font-size: 17px;
    flex-shrink: 0;
    filter: drop-shadow(0 1px 2px rgba(245,158,42,0.2));
  }

  .tree-node .node-name {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13.5px;
    color: #2d3748;
    font-weight: 500;
    letter-spacing: -0.01em;
  }

  .tree-node .node-name.file-node {
    color: #4a5568;
    font-weight: 400;
  }

  .tree-children {
    margin-left: 28px;
    border-left: 2px solid #f0c070;
    padding-left: 12px;
  }

  /* --- Toast --- */
  .toast {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--surface2);
    border: 1px solid var(--border-light);
    border-radius: 40px;
    padding: 10px 20px;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    z-index: 999;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    pointer-events: none;
  }

  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast .toast-icon { font-size: 15px; }

  /* --- Empty state --- */
  .empty-state {
    padding: 48px 20px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .empty-icon { font-size: 42px; opacity: 0.3; }

  .empty-text {
    font-size: 14px;
    color: var(--text-muted);
    font-family: var(--font-mono);
  }

  /* --- Divider line badge --- */
  .section-label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 11px;
    font-family: var(--font-mono);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .section-label::before, .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* hint text */
  .hint {
    font-size: 12px;
    color: var(--text-muted);
    font-family: var(--font-mono);
    padding: 8px 0 0 2px;
    line-height: 1.6;
  }

  .hint code {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 5px;
    color: var(--text-secondary);
  }

  /* --- Toggle switch --- */
  .toggle-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .toggle-label {
    font-size: 12px;
    color: var(--text-secondary);
    font-family: var(--font-mono);
    white-space: nowrap;
  }
  .toggle {
    position: relative;
    width: 34px;
    height: 18px;
    flex-shrink: 0;
  }
  .toggle input { opacity: 0; width: 0; height: 0; position: absolute; }
  .toggle-track {
    position: absolute;
    inset: 0;
    background: var(--border-light);
    border-radius: 20px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .toggle input:checked + .toggle-track { background: var(--accent); }
  .toggle-track::after {
    content: '';
    position: absolute;
    top: 2px; left: 2px;
    width: 14px; height: 14px;
    background: white;
    border-radius: 50%;
    transition: transform 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  }
  .toggle input:checked + .toggle-track::after { transform: translateX(16px); }

  /* --- Icon editor panel --- */
  .icon-panel {
    display: none;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }
  .icon-panel.visible { display: block; }
  .icon-panel-header {
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--surface2);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .icon-panel-title {
    font-size: 12px;
    font-family: var(--font-mono);
    color: var(--text-secondary);
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
  }
  .icon-panel-hint {
    font-size: 11px;
    color: var(--text-muted);
    font-family: var(--font-mono);
  }
  .icon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 8px;
    padding: 16px 20px;
  }
  .icon-entry {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 7px 10px;
    transition: border-color 0.15s;
  }
  .icon-entry:focus-within { border-color: var(--accent); }
  .ext-label {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
    min-width: 38px;
    text-transform: lowercase;
  }
  .icon-input {
    width: 32px;
    background: transparent;
    border: none;
    outline: none;
    font-size: 18px;
    text-align: center;
    cursor: text;
    color: var(--text-primary);
    padding: 0;
  }

  /* GitHub input focus */
  #input-github:focus, #input-github-token:focus {
    border-color: var(--accent) !important;
    box-shadow: 0 0 0 3px var(--accent-dim);
  }

  /* Loading spinner */
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    display: inline-block;
    width: 14px; height: 14px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: #0f1117;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    vertical-align: middle;
    margin-right: 6px;
  }

  .status-msg .spinner {
    border: 2px solid var(--border-light);
    border-top-color: var(--accent);
  }

  .status-msg {
    font-size: 12px;
    font-family: var(--font-mono);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .status-msg.loading { color: var(--text-secondary); }
  .status-msg.success { color: var(--green); }
  .status-msg.error   { color: #f87171; }

  /* Generate button row */
  #btn-generate {
    position: relative;
    overflow: hidden;
  }
  #btn-generate::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(105deg, transparent 40%, rgba(255,255,255,0.15) 50%, transparent 60%);
    transform: translateX(-100%);
    transition: transform 0s;
  }
  #btn-generate:hover::after {
    transform: translateX(100%);
    transition: transform 0.4s ease;
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">üìÅ</div>
    <div>
      <div class="logo-text">Folder<span>IO</span></div>
    </div>
  </div>
  <div class="tagline">folder structure ‚Üí visual tree</div>
</header>

<main>

  <!-- Input Panel -->
  <div class="panel">
    <div class="panel-header">
      <div class="panel-dot active"></div>
      <div class="panel-dot"></div>
      <div class="panel-dot"></div>
      <span class="panel-title">Input</span>
    </div>

    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="path">üìÇ Folder Path</button>
      <button class="tab" data-tab="readme">üìÑ README Tree</button>
      <button class="tab" data-tab="github">üêô GitHub URL</button>
    </div>

    <div class="tab-content active" id="tab-path">
      <textarea id="input-path" placeholder="Paste one path per line. The first line is the root, the rest are subfolders:&#10;&#10;D:\ORBIT1690\Google Drive Backup\FRC&#10;D:\ORBIT1690\Google Drive Backup\FRC\FRC 2007-2008&#10;D:\ORBIT1690\Google Drive Backup\FRC\FRC 2010-2011&#10;D:\ORBIT1690\Google Drive Backup\FRC\Part Library" rows="5"></textarea>
      <div class="hint">Paste one full path per line. First line = root. Each additional line = a subfolder (at any depth). Works with Windows <code>\</code> and Unix <code>/</code> paths.</div>
    </div>

    <div class="tab-content" id="tab-readme">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-top:16px; margin-bottom:8px;">
        <span class="hint" style="padding:0;">Supports <code>‚îú‚îÄ‚îÄ</code> <code>‚îî‚îÄ‚îÄ</code> <code>‚îÇ</code> tree characters, or indented plain text.</span>
        <button class="btn btn-ghost" id="btn-demo" style="font-size:12px; padding:5px 12px; white-space:nowrap; margin-left:12px;">üå≤ Load demo</button>
      </div>
      <textarea id="input-readme" placeholder="Paste a README-style tree here, e.g.:&#10;&#10;my-project/&#10;‚îú‚îÄ‚îÄ src/&#10;‚îÇ   ‚îú‚îÄ‚îÄ components/&#10;‚îÇ   ‚îî‚îÄ‚îÄ utils/&#10;‚îú‚îÄ‚îÄ public/&#10;‚îî‚îÄ‚îÄ package.json" rows="8"></textarea>
    </div>

    <div class="tab-content" id="tab-github">
      <input type="text" id="input-github" placeholder="https://github.com/owner/repo" style="
        width:100%; margin-top:16px;
        background: var(--bg); border: 1px solid var(--border);
        border-radius: var(--radius-sm); color: var(--text-primary);
        font-family: var(--font-mono); font-size: 13px;
        padding: 12px 16px; outline: none; transition: border-color 0.2s;
      ">
      <div id="github-status" style="margin-top:10px; min-height:20px;"></div>
      <div class="hint">Paste any public GitHub repo URL. Uses the GitHub API via CORS proxy ‚Äî no token needed for public repos. Large repos (like <code>golang/go</code>) may be truncated by GitHub at ~100k items. Add a token for private repos or higher rate limits.</div>
      <div style="margin-top:10px; display:flex; align-items:center; gap:8px;">
        <input type="password" id="input-github-token" placeholder="Optional: GitHub token for private repos or higher rate limits" style="
          flex:1;
          background: var(--bg); border: 1px solid var(--border);
          border-radius: var(--radius-sm); color: var(--text-primary);
          font-family: var(--font-mono); font-size: 12px;
          padding: 8px 12px; outline: none; transition: border-color 0.2s;
        ">
      </div>
    </div>
  </div>

  <!-- Config Panel -->
  <div class="panel" style="border-radius: var(--radius);">
    <div class="panel-header">
      <div class="panel-dot active"></div>
      <div class="panel-dot"></div>
      <div class="panel-dot"></div>
      <span class="panel-title">Configuration</span>
    </div>
    <div class="controls" style="border-top:none; border-radius:0 0 var(--radius) var(--radius);">
      <span class="depth-label">Depth:</span>
      <div class="depth-options" id="depth-options">
        <button class="depth-btn active" data-depth="top">Top level</button>
        <button class="depth-btn" data-depth="2">2 levels</button>
        <button class="depth-btn" data-depth="3">3 levels</button>
        <button class="depth-btn" data-depth="full">Full</button>
        <button class="depth-btn" data-depth="custom"># Custom</button>
      </div>
      <input type="number" id="custom-depth-input" min="1" max="20" value="4" placeholder="N">
      <div class="spacer"></div>
      <label class="toggle-row" title="Show emoji icons per file type">
        <span class="toggle-label">File icons</span>
        <span class="toggle">
          <input type="checkbox" id="toggle-icons" checked>
          <span class="toggle-track"></span>
        </span>
      </label>
      <button class="btn btn-ghost" id="btn-edit-icons" style="font-size:12px; padding:6px 14px;">‚úèÔ∏è Edit icons</button>
    </div>
  </div>

  <!-- Generate Row -->
  <div style="display:flex; justify-content:flex-end;">
    <button class="btn btn-primary" id="btn-generate" style="padding: 12px 32px; font-size:15px; border-radius: var(--radius);">
      <span>‚ú¶</span> Generate Tree
    </button>
  </div>

  <!-- Icon Editor Panel -->
  <div class="icon-panel" id="icon-panel">
    <div class="icon-panel-header">
      <span class="icon-panel-title">‚ú¶ File Type Icons</span>
      <span class="icon-panel-hint">Click any emoji to change it</span>
    </div>
    <div class="icon-grid" id="icon-grid">
      <!-- populated by JS -->
    </div>
  </div>

  <!-- Output Panel -->
  <div class="panel output-panel" id="output-panel">
    <div class="output-actions">
      <div class="info" id="output-info"><span>0</span> items</div>
      <div class="spacer"></div>
      <button class="btn btn-ghost" id="btn-copy" style="font-size:12px; padding:6px 14px;">
        üìã Copy PNG
      </button>
      <button class="btn btn-ghost" id="btn-png" style="font-size:12px; padding:6px 14px;">
        ‚¨áÔ∏è Download PNG
      </button>
    </div>
    <div id="tree-output">
      <div class="empty-state" id="empty-state">
        <div class="empty-icon">üå≥</div>
        <div class="empty-text">Your tree will appear here</div>
      </div>
    </div>
  </div>

</main>

<div class="toast" id="toast">
  <span class="toast-icon">‚úì</span>
  <span id="toast-msg">Copied!</span>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activeTab = 'path';
let depthMode = 'top'; // 'top' | '2' | '3' | 'full' | 'custom'
let treeData = null;
let showFileIcons = true;

// ‚îÄ‚îÄ‚îÄ File icon map ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FILE_ICONS = {
  // Code
  java:    '‚òï', js:     'üü®', ts:    'üî∑', py:    'üêç',
  cpp:     '‚öôÔ∏è',  c:      '‚öôÔ∏è',  h:     'üìé', cs:    'üîµ',
  html:    'üåê', css:    'üé®', json:  'üìã', xml:   'üìÑ',
  gradle:  'üêò', sh:     'üñ•Ô∏è',  rb:    'üíé', go:    'üêπ',
  // Docs
  pdf:     'üìï', docx:   'üìò', doc:   'üìò', xlsx:  'üìó',
  xls:     'üìó', pptx:   'üìô', ppt:   'üìô', txt:   'üìù',
  md:      'üìù', csv:    'üìä',
  // Design
  psd:     'üé≠', ai:     'üñåÔ∏è',  fig:   'üé®', svg:   'üî∑',
  png:     'üñºÔ∏è',  jpg:    'üñºÔ∏è',  jpeg:  'üñºÔ∏è',  gif:   'üñºÔ∏è',
  webp:    'üñºÔ∏è',
  // 3D / CAD
  stl:     'üßä', step:   'üî©', sldprt:'üîß', sldasm:'üîß',
  obj:     'üßä', fbx:    'üßä',
  // Media
  mp4:     'üé¨', mov:    'üé¨', avi:   'üé¨', mp3:   'üéµ',
  wav:     'üéµ', mkv:    'üé¨',
  // Archives
  zip:     'üóúÔ∏è',  rar:    'üóúÔ∏è',  gz:    'üóúÔ∏è',  tar:   'üóúÔ∏è',
  // Config
  env:     'üîê', yaml:   '‚öôÔ∏è',  yml:   '‚öôÔ∏è',  toml:  '‚öôÔ∏è',
  ini:     '‚öôÔ∏è',  cfg:    '‚öôÔ∏è',
  // Default
  default: 'üìÑ'
};

// Editable copy (user can change these)
const userIcons = { ...FILE_ICONS };

// ‚îÄ‚îÄ‚îÄ Build icon editor ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildIconEditor() {
  const grid = document.getElementById('icon-grid');
  grid.innerHTML = '';
  // Group: show unique extensions only (skip 'default')
  const entries = Object.entries(userIcons).filter(([k]) => k !== 'default');
  entries.forEach(([ext, icon]) => {
    const div = document.createElement('div');
    div.className = 'icon-entry';
    div.innerHTML = `
      <span class="ext-label">.${ext}</span>
      <input class="icon-input" type="text" maxlength="2" value="${icon}" data-ext="${ext}" title="Change icon for .${ext}">
    `;
    grid.appendChild(div);
  });

  // Live update on change
  grid.querySelectorAll('.icon-input').forEach(input => {
    input.addEventListener('input', () => {
      const ext = input.dataset.ext;
      const val = [...input.value].find(c => c.trim()) || FILE_ICONS[ext] || 'üìÑ';
      userIcons[ext] = val;
      input.value = val;
      // Re-render if tree exists
      if (treeData) regenerateTree();
    });
    // Select all on focus for easy replacement
    input.addEventListener('focus', () => input.select());
  });
}

function getFileIcon(filename) {
  const ext = filename.split('.').pop()?.toLowerCase();
  return userIcons[ext] || userIcons.default;
}

// ‚îÄ‚îÄ‚îÄ Toggle icons ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('toggle-icons').addEventListener('change', (e) => {
  showFileIcons = e.target.checked;
  // If turning off, always hide the panel
  if (!showFileIcons) {
    document.getElementById('icon-panel').classList.remove('visible');
    document.getElementById('btn-edit-icons').style.display = 'none';
  } else {
    document.getElementById('btn-edit-icons').style.display = 'flex';
  }
  if (treeData) regenerateTree();
});

// ‚îÄ‚îÄ‚îÄ Edit icons button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('btn-edit-icons').addEventListener('click', () => {
  const panel = document.getElementById('icon-panel');
  const btn = document.getElementById('btn-edit-icons');
  const isOpen = panel.classList.toggle('visible');
  btn.textContent = isOpen ? '‚ñ≤ Hide icons' : '‚úèÔ∏è Edit icons';
});

// Show panel by default (toggle is checked by default)
// Icon panel is hidden until user clicks "Edit icons" button
buildIconEditor();

// ‚îÄ‚îÄ‚îÄ Demo tree ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEMO_TREE = `FRC/
‚îú‚îÄ‚îÄ FRC 2022-2023/
‚îÇ   ‚îú‚îÄ‚îÄ CAD/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Robot_Assembly.step
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chassis.sldprt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Renders/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ robot_front.png
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ robot_iso.png
‚îÇ   ‚îú‚îÄ‚îÄ Code/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Robot.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subsystems/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DriveSubsystem.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ArmSubsystem.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ IntakeSubsystem.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commands/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AutoBalance.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ScoreCone.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ build.gradle
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ Documentation/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Engineering_Notebook.pdf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BOM.xlsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Chairman_Award.docx
‚îÇ   ‚îî‚îÄ‚îÄ Media/
‚îÇ       ‚îú‚îÄ‚îÄ reveal_video.mp4
‚îÇ       ‚îî‚îÄ‚îÄ team_photo.jpg
‚îú‚îÄ‚îÄ Part Library/
‚îÇ   ‚îú‚îÄ‚îÄ Motors/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NEO_spec.pdf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ motor_comparison.xlsx
‚îÇ   ‚îú‚îÄ‚îÄ Sensors/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Limelight_setup.md
‚îÇ   ‚îî‚îÄ‚îÄ 3D_Prints/
‚îÇ       ‚îú‚îÄ‚îÄ cable_bracket.stl
‚îÇ       ‚îî‚îÄ‚îÄ print_settings.json
‚îú‚îÄ‚îÄ Training/
‚îÇ   ‚îú‚îÄ‚îÄ Programming/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java_basics.pdf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wpilib_intro.pptx
‚îÇ   ‚îî‚îÄ‚îÄ Safety/
‚îÇ       ‚îú‚îÄ‚îÄ safety_rules.pdf
‚îÇ       ‚îî‚îÄ‚îÄ student_waiver.pdf
‚îî‚îÄ‚îÄ Admin/
    ‚îú‚îÄ‚îÄ budget_2023.xlsx
    ‚îú‚îÄ‚îÄ sponsor_list.csv
    ‚îî‚îÄ‚îÄ Outreach/
        ‚îú‚îÄ‚îÄ flyer_design.psd
        ‚îî‚îÄ‚îÄ impact_report.pdf`;

document.getElementById('btn-demo').addEventListener('click', () => {
  // Switch to readme tab
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.querySelector('[data-tab="readme"]').classList.add('active');
  document.getElementById('tab-readme').classList.add('active');
  activeTab = 'readme';
  document.getElementById('input-readme').value = DEMO_TREE;
  showToast('üå≤', 'Demo tree loaded!');
});

// ‚îÄ‚îÄ‚îÄ GitHub API fetch ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function parseGithubUrl(url) {
  // Accept: https://github.com/owner/repo or github.com/owner/repo
  const match = url.trim().replace(/\/$/, '')
    .match(/github\.com\/([^\/]+)\/([^\/\?#]+)/);
  if (!match) return null;
  return { owner: match[1], repo: match[2].replace(/\.git$/, '') };
}

function setGithubStatus(type, html) {
  const el = document.getElementById('github-status');
  el.innerHTML = `<div class="status-msg ${type}">${html}</div>`;
}

// CORS proxy ‚Äî try direct first, fall back to proxy
const CORS_PROXY = 'https://corsproxy.io/?';

async function githubFetch(url, headers) {
  // Try direct first (works when token is present or from some environments)
  try {
    const res = await fetch(url, { headers });
    if (res.ok) return res;
    // If rate limited or auth error, don't bother proxying
    if (res.status === 401 || res.status === 403) return res;
  } catch(e) {
    // Network/CORS error ‚Äî fall through to proxy
  }
  // Fall back to CORS proxy
  return fetch(CORS_PROXY + encodeURIComponent(url), { headers });
}

async function fetchGithubTree(owner, repo, token) {
  const headers = { 'Accept': 'application/vnd.github.v3+json' };
  if (token) headers['Authorization'] = `token ${token}`;

  // 1. Get default branch
  setGithubStatus('loading', '<span class="spinner"></span>Fetching repo info‚Ä¶');
  const repoRes = await githubFetch(`https://api.github.com/repos/${owner}/${repo}`, headers);
  if (!repoRes.ok) {
    const err = await repoRes.json().catch(() => ({}));
    throw new Error(err.message || `Repo not found (${repoRes.status})`);
  }
  const repoData = await repoRes.json();
  const branch = repoData.default_branch || 'main';

  // 2. Get full tree (recursive)
  setGithubStatus('loading', '<span class="spinner"></span>Loading file tree‚Ä¶');
  const treeRes = await githubFetch(
    `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`,
    headers
  );
  if (!treeRes.ok) {
    const err = await treeRes.json().catch(() => ({}));
    throw new Error(err.message || `Could not load tree (${treeRes.status})`);
  }
  const treeJson = await treeRes.json();

  const itemCount = treeJson.tree?.length || 0;
  if (treeJson.truncated) {
    setGithubStatus('success', `‚ö†Ô∏è Large repo ‚Äî showing first ${itemCount.toLocaleString()} items (truncated by GitHub)`);
  } else {
    setGithubStatus('success', `‚úì Loaded <strong>${itemCount.toLocaleString()}</strong> items from <strong>${owner}/${repo}</strong> (${branch})`);
  }

  return { items: treeJson.tree || [], repoName: repo, owner, branch };
}

function githubTreeToNodes({ items, repoName }) {
  // Build nested structure from flat path list
  const root = { name: repoName, fullPath: repoName, type: 'folder', children: [] };

  items.forEach(item => {
    const parts = item.path.split('/');
    let cursor = root;
    parts.forEach((part, i) => {
      const isLast = i === parts.length - 1;
      let child = cursor.children.find(c => c.name === part);
      if (!child) {
        child = {
          name: part,
          type: (isLast && item.type === 'blob') ? 'file' : 'folder',
          children: []
        };
        cursor.children.push(child);
      }
      cursor = child;
    });
  });

  return root;
}
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    activeTab = tab.dataset.tab;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('tab-' + activeTab).classList.add('active');
  });
});

// ‚îÄ‚îÄ‚îÄ Depth buttons ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.depth-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    depthMode = btn.dataset.depth;
    document.querySelectorAll('.depth-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const customInput = document.getElementById('custom-depth-input');
    customInput.style.display = depthMode === 'custom' ? 'inline-block' : 'none';
  });
});

// ‚îÄ‚îÄ‚îÄ Parse folder PATH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function parseFolderPath(raw) {
  const lines = raw.split('\n').map(l => l.trim()).filter(Boolean);
  if (!lines.length) return null;

  // Each line is a full path. Build a tree from all paths.
  // Normalize separators to forward slash
  const allPaths = lines.map(l => l.replace(/\\/g, '/').replace(/\/+$/, ''));

  // Find common root prefix across all lines
  // Use the first line as root anchor
  const rootPath = allPaths[0];
  const rootSegments = rootPath.split('/').filter(Boolean);

  // Build a nested map from path segments
  function insertPath(tree, segments) {
    if (!segments.length) return;
    const seg = segments[0];
    if (!tree[seg]) tree[seg] = {};
    insertPath(tree[seg], segments.slice(1));
  }

  const pathMap = {};
  // Insert root itself
  rootSegments.forEach((seg, i) => {
    insertPath(pathMap, rootSegments.slice(0, i + 1));
  });

  // Insert all subsequent lines relative to root
  for (let i = 1; i < allPaths.length; i++) {
    const p = allPaths[i];
    const segs = p.split('/').filter(Boolean);
    insertPath(pathMap, segs);
  }

  // Convert the map into our tree node format
  function mapToTree(map, name, fullPath) {
    const keys = Object.keys(map);
    const children = keys.map(k => {
      const childPath = fullPath ? fullPath + '/' + k : k;
      return mapToTree(map[k], k, childPath);
    });
    return { name, fullPath, type: 'folder', children };
  }

  // The root is the first line; drill into the map to that node
  let cursor = pathMap;
  for (const seg of rootSegments) {
    cursor = cursor[seg] || {};
  }

  const rootDisplayName = rootSegments[rootSegments.length - 1] || rootPath;
  const children = Object.keys(cursor).map(k =>
    mapToTree(cursor[k], k, rootPath + '/' + k)
  );

  return {
    name: rootDisplayName,
    fullPath: rootPath.replace(/\//g, navigator.platform.includes('Win') ? '\\' : '/'),
    type: 'folder',
    children
  };
}

// ‚îÄ‚îÄ‚îÄ Parse README tree ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function parseReadmeTree(raw) {
  const lines = raw.split('\n').filter(l => l.trim());
  if (!lines.length) return null;

  // Normalize tree chars ‚Üí measure depth
  const normalized = lines.map(line => {
    // Count leading tree characters + spaces as indentation
    const stripped = line
      .replace(/‚îÇ/g, '|')
      .replace(/‚îú‚îÄ‚îÄ/g, '|--')
      .replace(/‚îî‚îÄ‚îÄ/g, '`--')
      .replace(/\|--/g, '  ')
      .replace(/`--/g, '  ')
      .replace(/\|/g, ' ');

    const leadingSpaces = stripped.length - stripped.trimStart().length;
    const name = line.replace(/^[\s‚îÇ‚îú‚îî‚îÄ`|\\-]+/, '').trim();
    return { depth: Math.floor(leadingSpaces / 2), name, raw: line };
  });

  // Build tree from depth info
  function buildTree(items) {
    const root = { name: items[0]?.name || 'root', type: 'folder', children: [], fullPath: '' };
    const stack = [{ node: root, depth: -1 }];

    for (let i = 1; i < items.length; i++) {
      const item = items[i];
      const name = item.name.replace(/\/$/, '');
      const isFolder = item.raw.trim().endsWith('/') || !/\.\w+$/.test(name);
      const node = { name, type: isFolder ? 'folder' : 'file', children: [] };

      // Pop stack until we find a valid parent
      while (stack.length > 1 && stack[stack.length - 1].depth >= item.depth) {
        stack.pop();
      }

      stack[stack.length - 1].node.children.push(node);
      if (isFolder) stack.push({ node, depth: item.depth });
    }

    return root;
  }

  return buildTree(normalized);
}

// ‚îÄ‚îÄ‚îÄ Depth filter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterDepth(node, maxDepth, currentDepth = 0) {
  if (!node) return null;
  const copy = { ...node };
  if (!copy.children) return copy;

  if (depthMode === 'top') {
    copy.children = currentDepth === 0 ? copy.children.map(c => ({ ...c, children: [] })) : [];
  } else if (depthMode === 'full') {
    copy.children = copy.children.map(c => filterDepth(c, maxDepth, currentDepth + 1));
  } else {
    const limit = depthMode === 'custom'
      ? parseInt(document.getElementById('custom-depth-input').value) || 4
      : parseInt(depthMode);
    if (currentDepth >= limit) {
      copy.children = [];
    } else {
      copy.children = copy.children.map(c => filterDepth(c, maxDepth, currentDepth + 1));
    }
  }
  return copy;
}

// ‚îÄ‚îÄ‚îÄ Count items ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function countItems(node) {
  if (!node) return 0;
  let count = 0;
  if (node.children) {
    count += node.children.length;
    node.children.forEach(c => { count += countItems(c); });
  }
  return count;
}

// ‚îÄ‚îÄ‚îÄ Render tree to HTML ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getNodeIcon(node) {
  if (node.type === 'folder') return 'üìÅ';
  if (!showFileIcons) return 'üìÑ';
  return getFileIcon(node.name);
}

function renderNode(node, isRoot = false) {
  const div = document.createElement('div');

  if (isRoot) {
    div.className = 'tree-root-path';
    div.innerHTML = `
      <span class="root-icon">üíª</span>
      <span class="root-label">${escHtml(node.fullPath || node.name)}</span>
    `;
    const childWrap = document.createElement('div');
    if (node.children && node.children.length) {
      node.children.forEach(child => childWrap.appendChild(renderNode(child)));
    }
    const wrap = document.createElement('div');
    wrap.appendChild(div);
    wrap.appendChild(childWrap);
    return wrap;
  }

  const icon = getNodeIcon(node);
  div.className = 'tree-node';
  div.innerHTML = `
    <span class="folder-icon">${icon}</span>
    <span class="node-name ${node.type === 'file' ? 'file-node' : ''}">${escHtml(node.name)}</span>
  `;

  if (node.children && node.children.length) {
    const childWrap = document.createElement('div');
    childWrap.className = 'tree-children';
    node.children.forEach(child => childWrap.appendChild(renderNode(child)));
    const wrap = document.createElement('div');
    wrap.appendChild(div);
    wrap.appendChild(childWrap);
    return wrap;
  }

  return div;
}

// ‚îÄ‚îÄ‚îÄ Re-render without re-parsing ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function regenerateTree() {
  const filtered = filterDepth(treeData, 99);
  const total = countItems(filtered);
  const output = document.getElementById('tree-output');
  output.innerHTML = '';
  output.appendChild(renderNode(filtered, true));
  document.getElementById('output-info').innerHTML = `<span>${total}</span> item${total !== 1 ? 's' : ''}`;
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// ‚îÄ‚îÄ‚îÄ Generate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('btn-generate').addEventListener('click', async () => {
  let raw = '';
  if (activeTab === 'path') {
    raw = document.getElementById('input-path').value.trim();
    if (!raw) return showToast('‚ö†Ô∏è', 'Please enter a folder path first');
    treeData = parseFolderPath(raw);
  } else if (activeTab === 'readme') {
    raw = document.getElementById('input-readme').value.trim();
    if (!raw) return showToast('‚ö†Ô∏è', 'Please paste a README tree first');
    treeData = parseReadmeTree(raw);
  } else if (activeTab === 'github') {
    const url = document.getElementById('input-github').value.trim();
    const token = document.getElementById('input-github-token').value.trim();
    if (!url) return showToast('‚ö†Ô∏è', 'Please enter a GitHub URL');
    const parsed = parseGithubUrl(url);
    if (!parsed) return showToast('‚ö†Ô∏è', 'Invalid GitHub URL');

    const btn = document.getElementById('btn-generate');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span> Fetching‚Ä¶';

    try {
      const result = await fetchGithubTree(parsed.owner, parsed.repo, token);
      treeData = githubTreeToNodes(result);
    } catch (e) {
      setGithubStatus('error', '‚úó ' + e.message);
      btn.disabled = false;
      btn.innerHTML = '<span>‚ú¶</span> Generate';
      return;
    }

    btn.disabled = false;
    btn.innerHTML = '<span>‚ú¶</span> Generate';
  }

  if (!treeData) return showToast('‚ö†Ô∏è', 'Could not parse the input');

  regenerateTree();

  // Show panel
  document.getElementById('output-panel').classList.add('visible');
});

// ‚îÄ‚îÄ‚îÄ Copy PNG to clipboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('btn-copy').addEventListener('click', () => {
  if (!treeData) return showToast('‚ö†Ô∏è', 'Generate a tree first');
  const el = document.getElementById('tree-output');
  html2canvas(el, {
    backgroundColor: '#f8f9fb',
    scale: 2,
    useCORS: true,
    logging: false
  }).then(canvas => {
    canvas.toBlob(blob => {
      if (!blob) return showToast('‚ö†Ô∏è', 'Could not generate image');
      try {
        const item = new ClipboardItem({ 'image/png': blob });
        navigator.clipboard.write([item]).then(() => {
          showToast('üìã', 'PNG copied to clipboard!');
        }).catch(() => {
          showToast('‚ö†Ô∏è', 'Clipboard access denied ‚Äî try Download instead');
        });
      } catch (e) {
        showToast('‚ö†Ô∏è', 'Browser does not support image clipboard');
      }
    }, 'image/png');
  });
});

// ‚îÄ‚îÄ‚îÄ Export PNG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('btn-png').addEventListener('click', () => {
  const el = document.getElementById('tree-output');
  html2canvas(el, {
    backgroundColor: '#f8f9fb',
    scale: 2,
    useCORS: true,
    logging: false
  }).then(canvas => {
    const link = document.createElement('a');
    link.download = 'folder-structure.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    showToast('üñº', 'PNG exported!');
  });
});

// ‚îÄ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(icon, msg) {
  const toast = document.getElementById('toast');
  document.querySelector('.toast-icon').textContent = icon;
  document.getElementById('toast-msg').textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2400);
}
</script>
</body>
</html>
